'''‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏õ‡∏•‡∏∏‡∏¢ Project 10: ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° (Meeting Booking) 
üìÖ ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ "‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏≤‡∏ö‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô" ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Logic ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
‡πÇ‡∏à‡∏ó‡∏¢‡πå: ‡∏õ‡πã‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤ "‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏±‡∏ô‡∏ä‡∏ô‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°?"
‡∏ô‡∏≤‡∏¢ ‡∏Å. ‡∏à‡∏≠‡∏á 09:00 - 11:00
‡∏ô‡∏≤‡∏¢ ‡∏Ç. ‡∏à‡∏∞‡∏°‡∏≤‡∏à‡∏≠‡∏á 10:00 - 12:00
‡∏ï‡πâ‡∏≠‡∏á‡∏´‡πâ‡∏≤‡∏°‡∏à‡∏≠‡∏á! ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ 10 ‡πÇ‡∏°‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å Logic ‡∏ú‡∏°‡∏à‡∏∞‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (0-24)" 
‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏≠‡∏á 9 ‡∏ñ‡∏∂‡∏á 11) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡πã‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏Ñ‡∏£‡∏±‡∏ö'''
import os


script = os.path.dirname(__file__)
filename = os.path.join(script, "bookings.txt")

def load_booking():
    '''‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á'''

    bookings = []
    if os.path.exists(filename):
        with open(filename, encoding='utf-8') as f:
            for line in f:
                # Format: ‡∏´‡πâ‡∏≠‡∏á, ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏à‡∏≠‡∏á, ‡πÄ‡∏£‡∏¥‡πà‡∏°, ‡∏à‡∏ö
                parts = line.strip().split(',')
                if len(parts) == 4:
                    bookings.append(parts)
    return bookings

def save_bookings(bookings):
    with open(filename, 'w', encoding='utf-8') as f:
        for item in bookings:
            line = ','.join(item)
            f.write(line + '\n')
    print('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!')

def show_schedule(bookings:list):
    print('\n' + '='*60)
    print(f"{'No.':>4} {'‡∏´‡πâ‡∏≠‡∏á:':<15} {'‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á':<15} {'‡πÄ‡∏£‡∏¥‡πà‡∏°':<5} {'‡∏à‡∏ö':<5}")
    print('='*60)
    bookings.sort()
    for i, item in enumerate(bookings):
        print(f"{i+1:>4}. {item[0]:<15} {item[1]:<15} {item[2]:<5} {item[3]:<5}")
    print('='*60)

def check_overlap(new_start, new_end, old_start, old_end):
    '''
    function check ‡πÄ‡∏ß‡∏•‡∏≤‡∏ä‡∏ô‡∏Å‡∏±‡∏ô 
    ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ True ‡∏ñ‡πâ‡∏≤‡∏ä‡∏ô, False ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ä‡∏ô
    '''
    ns = int(new_start)
    ne = int(new_end)
    old_s = int(old_start)
    oe = int(old_end)

    # ‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡∏ä‡∏ô‡∏Å‡∏±‡∏ô:
    # "‡∏ñ‡πâ‡∏≤ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏ö‡πÄ‡∏Å‡πà‡∏≤ AND ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏ö‡πÉ‡∏´‡∏°‡πà ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡πà‡∏≤"
    # ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà
    if ns < oe and ne > old_s:
        return True
    else:
        return False
    
def book_room(bookings):
    print('\n--- üìÖ ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ---')
    room = input('‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á (Meeting1/Meeting2): ').strip()
    name = input('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á: ').strip()

    try:
        start = int(input('‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° (0-23): '))
        duration = int(input('‡∏à‡∏≠‡∏á‡∏Å‡∏µ‡πà‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á: '))
        end = start + duration
    except ValueError:
        print('‚ùå ‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!')
        return
    
    # --- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏´‡∏°? ---
    is_busy = False

    for item in bookings:
        # item[0]=‡∏´‡πâ‡∏≠‡∏á, item[1]=‡πÄ‡∏£‡∏¥‡πà‡∏°, item[2]=‡∏à‡∏ö
        existing_room = item[0]
        existing_start = item[2]
        existing_end = item[3]

        # 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°?
        if existing_room == room:
            # 2. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≠
            if check_overlap(start, end, existing_start, existing_end):
                print(f'‡∏à‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÄ‡∏ß‡∏•‡∏≤‡∏ä‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì {item[1]} ({existing_start}-{existing_end})')
                is_busy = True
                break
    if not is_busy:
        # ‡∏ñ‡πâ‡∏≤‡∏´‡∏•‡∏∏‡∏î‡∏•‡∏π‡∏õ‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ä‡∏ô‡πÉ‡∏Ñ‡∏£‡πÄ‡∏•‡∏¢ -> ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ!
        # ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô str ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á list
        bookings.append([room, name, str(start), str(end)])
        save_bookings(bookings)
        print(f'‚úÖ ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á {room} ‡πÄ‡∏ß‡∏•‡∏≤ {start}.00 - {end}.00 ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!')
