import os
import datetime

def load_menu(filename:str):
    data = []
    # ‡πÉ‡∏ä‡πâ try-except ‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ (‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ï‡∏±‡∏î try ‡∏≠‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö)
    if not os.path.exists(filename):
        return []
        
    with open(filename, encoding='utf-8') as list_data:
        for line in list_data:
            # ‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ß‡πà‡∏≤‡∏á
            if line.strip(): 
                parts = line.strip().split(',')
                if len(parts) == 2:
                    product, price = parts
                    data.append([product, int(price)])
    return data # <--- ‡πÅ‡∏Å‡πâ Indent ‡πÅ‡∏•‡πâ‡∏ß

def show_menu(menu_list):
    print('='*40)
    print('      ‡πÄ‡∏°‡∏ô‡∏π‡∏£‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏ô‡∏° ‡∏õ‡πã‡∏≤ POS ^_^ _/|\\_      ')
    print('='*40)
    for i, p in enumerate(menu_list):
        # ‡∏à‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ß‡∏¢‡πÜ ‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢ ‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤
        print(f'{i+1}. {p[0]:<20} {p[1]:>5} ‡∏ö‡∏≤‡∏ó')

def save_sale(items, total):
    filename = 'sales.txt'
    now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    # ‡πÉ‡∏ä‡πâ join ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ comma
    items_str = ",".join(items)
    
    with open(filename, 'a', encoding='utf-8') as data:
        # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å format: ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤,‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£,‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°
        data.write(f"{now},{items_str},{total}\n")

def main():
    filename = 'menu.txt'
    
    if not os.path.exists(filename):
        print(f"‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå {filename} ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö‡∏õ‡πã‡∏≤! ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞")
        return

    my_menu = load_menu(filename)
    
    orders = [] 
    total_price = 0
    
    while True:
        # Clear ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏ö‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡πÜ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ) ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ
        print("\n"*2) 
        show_menu(my_menu)
        
        print("-" * 40)
        print(f"üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏õ‡πã‡∏≤: {orders}")
        print(f"üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: {total_price} ‡∏ö‡∏≤‡∏ó")
        print("-" * 40)

        choice = input("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π (‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç) ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå 'q' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏ö/‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô: ")
        
        if choice == 'q':
            break
        elif choice.isdigit():
            index = int(choice) - 1 # ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏•‡∏Ç‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå (1) ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≠‡∏° (0)
            
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏Ç index ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô list ‡πÑ‡∏´‡∏°
            if 0 <= index < len(my_menu):
                selected_item = my_menu[index] # ‡πÑ‡∏î‡πâ ['‡∏ä‡∏≤‡∏ô‡∏°', 40]
                
                orders.append(selected_item[0]) # ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠
                total_price += selected_item[1] # ‡∏ö‡∏ß‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤
            else:
                print("‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö")
                input("‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà...") # ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏π‡πâ‡∏ï‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô loop
        else:
            print("‚ùå ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡∏Ç ‡∏´‡∏£‡∏∑‡∏≠ q ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö")

    # --- ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ---
    if total_price > 0:
        print(f"\n>>> ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: {total_price} ‡∏ö‡∏≤‡∏ó <<<")
        save_sale(orders, total_price)
        print("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏•‡∏á sales.txt ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö")
    else:
        print("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏∞‡πÑ‡∏£)")

if __name__ == "__main__":
    main()