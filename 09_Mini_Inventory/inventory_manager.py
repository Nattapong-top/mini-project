'''üì¶ Project 9: ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Mini Inventory)
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô:
‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏•‡∏Ç: ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (String) ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£ ‡∏ö‡∏ß‡∏Å/‡∏•‡∏ö ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Integer)
Logic ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ "‡∏Ç‡∏≠‡∏á‡∏û‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡πÑ‡∏´‡∏°?" (‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°: ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô x ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÉ‡∏ô‡πÇ‡∏Å‡∏î‡∏±‡∏á'''

# ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤,‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô,‡∏£‡∏≤‡∏Ñ‡∏≤

import os

script_dir = os.path.dirname(__file__)
filename = os.path.join(script_dir, 'stock.txt')

def load_products():
    '''‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'''
    products = []
    if os.path.exists(filename):
        with open(filename, encoding='utf-8') as f:
            for line in f:
                parts = line.strip().split(',')
                if len(parts) == 4:
                    products.append(parts)
    return products

def save_products(products:list):
    '''‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå'''
    with open(filename, 'w', encoding='utf-8') as f:
        for item in products:
            # item ‡∏Ñ‡∏∑‡∏≠ [‡∏£‡∏´‡∏±‡∏™, ‡∏ä‡∏∑‡πà‡∏≠, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô, ‡∏£‡∏≤‡∏Ñ‡∏≤]
            # ‡πÄ‡∏ß‡∏•‡∏≤ save ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô string ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ comma 
            line = ','.join(item)
            f.write(line + '\n')
    print('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!')

def show_all_products(products:list):
    print('\n' + '='*60)
    print(f"{'No.':<4} {'‡∏£‡∏´‡∏±‡∏™':<10} {'‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤':<20} {'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô':>10} {'‡∏£‡∏≤‡∏Ñ‡∏≤':>10}")
    print('='*60)

    for i, item in enumerate(products):
        # item[2] ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô, item[3] ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤
        # ‡πÉ‡∏ä‡πâ > ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏á‡∏´‡∏•‡∏±‡∏Å
        print(f'{str(i+1)+'.'} {item[0]:<10} {item[1]:<20} {item[2]:>10} {item[3]:>10}')
    print('='*60)

def add_product(products):
    print('\n--- ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ---')
    code = input('‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (P01): ').strip().upper()

    # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ã‡πâ‡∏≥
    for item in products:
        if item[0] == code:
            print(f'‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ {item[0]} ‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß')
            return
    
    name = input('‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ').strip()

    while True:
        qty = input('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ').strip()
        if not qty.isdigit():
            print('‡∏õ‡πâ‡∏≠‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö')
        else:
            break
    
    while True:
        price = input('‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ').strip()
        if not price.isdigit():
            print('‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö')
        else:
            break

    # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô string ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≠‡∏¢‡πÅ‡∏õ‡∏•‡∏á)
    products.append([code, name, qty, price])
    save_products(products)
    print(f'‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° {name} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß')

def update_stock(products:list):
    '''‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤/‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å'''
    print('\n--- üì¶ ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ï‡πä‡∏≠‡∏Å ---')
    target_code = input('‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ').strip().upper()

    found = False

    for item in products:
        if item[0] == target_code:
            print(f'‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: {item[1]} | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: {item[2]} ‡∏ä‡∏¥‡πâ‡∏ô')

            print('[1] ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ (+)')
            print('[2] ‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å (-)')
            action = input('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ').strip()

            while True:
                amount_str = input('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏µ‡πà‡∏ä‡∏¥‡πâ‡∏ô: ')
                if not amount_str.isdigit():
                    print('‚ùå ‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô')
                else:
                    break
            amount = int(amount_str)    # ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            current_qty = int(item[2])  # ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° (‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô int ‡∏Å‡πà‡∏≠‡∏ô!)

            if action == '1':
                # --- (A) ‡πÇ‡∏ã‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ ---
                # ‡∏õ‡πã‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏¥‡∏° code ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡πÄ‡∏≠‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° + ‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                # new_qty = current_qty + amount     
                new_qty = current_qty + amount
                print(f'‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ {amount} ‡∏ä‡∏¥‡πâ‡∏ô')           
            
            elif action == '2':
                # --- (B) ‡πÇ‡∏ã‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å ---
                # ‡∏õ‡πã‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ ‡∏Ç‡∏≠‡∏á‡∏û‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡πÑ‡∏´‡∏°?
                if amount > current_qty:
                    print(f'‚ùå ‡∏Ç‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡∏°‡∏µ‡πÅ‡∏Ñ‡πà {current_qty} ‡∏ä‡∏¥‡πâ‡∏ô)')
                    return # ‡∏≠‡∏≠‡∏Å‡∏à‡πâ‡∏≤ def ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                
                # ‡∏ñ‡πâ‡∏≤‡∏û‡∏≠ ‡∏Å‡πá‡∏•‡∏ö‡πÄ‡∏•‡∏¢
                new_qty = current_qty - amount
                print(f'‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ {amount} ‡∏ä‡∏¥‡πâ‡∏ô')
            
            else:
                print('‚ùå ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏î')
                return

            # --- (C) ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô List ---
            # ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô String ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á list ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ function save ‡πÄ‡∏£‡∏≤ save ‡πÄ‡∏õ‡πá‡∏ô string
            item[2] = str(new_qty)

            found = True
            print(f'‚úÖ ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà: {new_qty} ‡∏ä‡∏¥‡πâ‡∏ô')
            save_products(products) # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå
            break
    
    if not found:
        print('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ')
                
