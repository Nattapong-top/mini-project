'''Project 8: ‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (Contact Book)
‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö ‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, ‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô'''

import os

# 
script_dir = os.path.dirname(__file__)
filename = os.path.join(script_dir, 'contract.txt')

def load_contracts():
    '''‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå'''
    contract = []
    if os.path.exists(filename):
        with open(filename, encoding='utf-8') as f:
            for line in f:
                # ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ‡∏ä‡∏∑‡πà‡∏≠,‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£,‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                parts = line.strip().split(',')
                # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏°
                if len(parts) == 3:
                    contract.append(parts)
    return contract

def save_contracts(contracts:list):
    '''‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ö‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå'''
    with open(filename, 'w', encoding='utf-8') as f:
        for item in contracts:
            line = ','.join(item)
            f.write(line + '\n')
    print('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!')

def show_all_contracts(contracts:list):
    '''‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á'''
    print('\n' + '='*60)
    print(f"{'No.':<4} {'‡∏ä‡∏∑‡πà‡∏≠':<25} {'‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£':<15} {'‡∏≠‡∏µ‡πÄ‡∏°‡∏•':<20}")
    print('='*60)

    if not contracts:
        print(" (‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)")
    else:
        for i, item in enumerate(contracts):
            # i=No. item[0]=‡∏ä‡∏∑‡πà‡∏≠, item[1]=‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, item[2]=email
            print(f'{i+1:<4} {item[0]:<23} {item[1]:<15} {item[2]:<20}')
            print('='*60)

def add_contract(contracts:list):
    '''‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà'''
    print('\n--- ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà ---')
    name = input('‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•: ').strip()

    # ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏´‡∏°
    if not name:
        print('‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!')
        return

    for item in contracts:
        if item[0] == name:
            print(f'‚ùå ‡∏ä‡∏∑‡πà‡∏≠ {name} ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö')
            return

    phone = input('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ').strip()
    email = input('‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏î Enter): ').strip()

    # ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà - ‡πÅ‡∏ó‡∏ô
    if not email:
        email = '-'

    # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á list ‡πÅ‡∏•‡∏∞ save
    contracts.append([name, phone, email])
    save_contracts(contracts)
    print(f'‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∏‡∏ì {name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!')


def delete_contract(contracts:list):
    '''‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠'''
    target_contract = input('‡∏õ‡πâ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö: ').strip()

    found = False

    # ‡∏ß‡∏±‡∏ô‡∏•‡∏π‡∏õ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö
    for item in contracts:
        if item[0] == target_contract:
            print(f'‡πÄ‡∏à‡∏≠‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ {item[0]} ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ {item[1]} ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö')

            confirm = input('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÑ‡∏´‡∏°? (y/n): ').strip().lower()

            if confirm == 'y':
                contracts.remove(item)
                found = True
                print('‚úÖ ‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!')
                break
            else:
                print('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö')
                return
    if found:
        save_contracts(contracts)
    else:
        print('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö')

def update_contract(contracts:list):
    '''‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏∞‡πÑ‡∏£ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô)'''
    print('\n--- üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ ---')
    target_name = input('‡∏õ‡πâ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ').strip()
    found = False

    # 1. ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≠‡∏Å‡πà‡∏≠‡∏ô
    for item in contracts:
        # item[0]=‡∏ä‡∏∑‡πà‡∏≠, item[1]=‡πÄ‡∏ö‡∏≠‡∏£‡πå, item[2]=‡∏≠‡∏µ‡πÄ‡∏°‡∏•
        if item[0] == target_name:
            print(f'\n‚úÖ ‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß: {item[0]} | {item[1]} | {item[2]}')
                
            while True:
                print('-------------------')
                print(f'‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏∞‡πÑ‡∏£‡∏Ç‡∏≠‡∏á "{item[0]}" ?')
                print('[1] ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠')
                print('[2] ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£')
                print('[3] ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏µ‡πÄ‡∏°‡∏•')
                print('[0] ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å/‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô')
                
                choice = input('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠: ').strip()

                if choice == '1':
                    new_name = input('‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà: ')
                    if new_name:
                        item[0] = new_name
                        print('--> ‡πÄ‡∏õ‡∏•‡∏µ‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢')

                elif choice == "2":
                    new_phone = input('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÉ‡∏´‡∏°‡πà: ').strip()
                    if new_name:
                        item[1] = new_phone
                        print('--> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢')

                elif choice == '3':
                    new_email = input('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡∏°‡πà: ')
                    if new_email:
                        item[2] = new_email
                        print('--> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢')

                elif choice == '0':
                    break
                
                else:
                    print('‚ùå ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!')
            
            found = True
            save_contracts(contracts)
            print('üíæ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!')
            break
    
    if not found:
        print(f'‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠ "{target_name}" ‡πÉ‡∏ô‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ñ‡∏£‡∏±‡∏ö')

